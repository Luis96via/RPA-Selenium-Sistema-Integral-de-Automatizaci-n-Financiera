<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ RPA - Sistema Integral de Automatizaci√≥n Financiera</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(149, 165, 166, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(23, 162, 184, 0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(23, 162, 184, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
        }

        .status.running {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.stopped {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .terminal-container {
            padding: 30px;
            background: #1e1e1e;
            min-height: 500px;
        }

        .terminal-header {
            background: #2d2d2d;
            color: #fff;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-dots {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27ca3f; }

        .terminal {
            background: #000;
            color: #00ff00;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .terminal::-webkit-scrollbar {
            width: 8px;
        }

        .terminal::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        .terminal::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .terminal::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* Documentaci√≥n */
        .docs-toggle {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .docs-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background: #ffffff;
        }

        .docs-container.expanded {
            max-height: none;
        }

        .docs-content {
            padding: 40px;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
        }

        .docs-content::-webkit-scrollbar {
            width: 8px;
        }

        .docs-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .docs-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .docs-content::-webkit-scrollbar-thumb:hover {
            background: #5a6fd8;
        }

        .docs-section {
            margin-bottom: 40px;
        }

        .docs-section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .docs-section h3 {
            color: #34495e;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .tech-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tech-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .tech-card p {
            color: #6c757d;
            font-size: 0.95em;
        }

        .flow-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .flow-step-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .flow-step-content {
            flex: 1;
        }

        .flow-step-content h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .flow-step-content p {
            color: #6c757d;
            font-size: 0.95em;
        }

        .flow-arrow {
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
            margin: 10px 0;
        }

        .features-list {
            list-style: none;
            padding: 0;
        }

        .features-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
        }

        .features-list li:before {
            content: "‚úÖ";
            margin-right: 15px;
            font-size: 1.2em;
        }

        .footer {
            padding: 20px 30px;
            background: #f8f9fa;
            text-align: center;
            color: #6c757d;
            border-top: 1px solid #e9ecef;
            position: relative;
        }

        .config-icon {
            position: absolute;
            bottom: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.2em;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .config-icon:hover {
            color: #667eea;
            opacity: 1;
            transform: rotate(90deg);
        }

        /* Modal de configuraci√≥n */
        .config-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .config-modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
            margin-top: 0.2%;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-modal-header h3 {
            margin: 0;
            font-size: 1.3em;
        }

        .config-modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .config-modal-close:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .config-modal-body {
            padding: 30px;
        }

        .config-form-group {
            margin-bottom: 20px;
        }

        .config-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .config-form-group input,
        .config-form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        .config-form-group input:focus,
        .config-form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .config-form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .config-modal-footer {
            padding: 20px 30px;
            background: #f8f9fa;
            border-radius: 0 0 20px 20px;
            text-align: right;
        }

        .config-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .config-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .config-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .config-btn-secondary {
            background: #6c757d;
            color: white;
        }

        .config-btn-secondary:hover {
            background: #5a6268;
        }

        .email-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }

        .email-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .email-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .email-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .email-text {
            font-weight: 600;
            color: #2c3e50;
        }

        .email-name {
            font-size: 0.85em;
            color: #6c757d;
            font-style: italic;
        }

        .email-actions {
            display: flex;
            gap: 5px;
        }

        .edit-email, .remove-email {
            background: none;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .edit-email {
            background: #28a745;
            color: white;
        }

        .edit-email:hover {
            background: #218838;
            transform: scale(1.1);
        }

        .remove-email {
            background: #dc3545;
            color: white;
        }

        .remove-email:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .add-email-section {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .email-input {
            flex: 2;
        }

        .email-name-input {
            flex: 1;
        }

        .add-email-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .add-email-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .config-cancel {
            background: #6c757d;
            color: white;
        }

        .config-cancel:hover {
            background: #5a6268;
        }

        .config-save {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .config-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .btn {
                margin: 5px;
                padding: 12px 20px;
                font-size: 1em;
            }
            
            .terminal {
                height: 300px;
                font-size: 12px;
                white-space: pre;
                overflow-x: auto;
            }

            .tech-grid {
                grid-template-columns: 1fr;
            }

            .docs-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ RPA - Sistema Integral de Automatizaci√≥n Financiera</h1>
            <p>Panel de Control - Automatizaci√≥n Completa de Procesos Financieros</p>
        </div>

        <div class="controls">
            <button id="startBtn" class="btn btn-primary">
                üöÄ Iniciar RPA
            </button>
            <button id="stopBtn" class="btn btn-danger" disabled>
                ‚èπÔ∏è Detener RPA
            </button>
            <button id="clearBtn" class="btn btn-secondary">
                üóëÔ∏è Limpiar Terminal
            </button>
            <button id="docsBtn" class="btn btn-info">
                üìö Documentaci√≥n
            </button>
            
            <div id="status" class="status stopped">
                ‚è∏Ô∏è RPA Detenido
            </div>
        </div>

        <div class="terminal-container">
            <div class="terminal-header">
                <div class="terminal-title">
                    <span>üíª Terminal RPA</span>
                </div>
                <div class="terminal-dots">
                    <div class="dot red"></div>
                    <div class="dot yellow"></div>
                    <div class="dot green"></div>
                </div>
            </div>
            <div id="terminal" class="terminal">
                Bienvenido al Panel de Control RPA
                ======================================
                
                Este panel te permite ejecutar el RPA de Automatizaci√≥n 
                Financiera directamente desde el navegador.
                
                Haz clic en "üöÄ Iniciar RPA" para comenzar la 
                automatizaci√≥n.
                
                La salida se mostrar√° aqu√≠ en tiempo real...
                
                ======================================
            </div>
        </div>

        <!-- Documentaci√≥n -->
        <div class="docs-toggle">
            <button id="docsToggleBtn" class="btn btn-info">
                üìö Documentaci√≥n T√©cnica
            </button>
        </div>

        <div id="docsContainer" class="docs-container">
            <div class="docs-content">
                <!-- Descripci√≥n General -->
                <div class="docs-section">
                    <h2>üéØ Descripci√≥n del Proyecto</h2>
                    <p>Este es un sistema integral de automatizaci√≥n rob√≥tica (RPA) desarrollado con Python y Selenium que automatiza completamente el proceso de extracci√≥n, procesamiento y reporte de datos financieros desde un portal web.</p>
                    
                    <div class="tech-grid">
                        <div class="tech-card">
                            <h4>ü§ñ RPA con Selenium</h4>
                            <p>Automatizaci√≥n completa de login y extracci√≥n de datos de sitios web financieros</p>
                        </div>
                        <div class="tech-card">
                            <h4>üîê Resoluci√≥n de Captchas</h4>
                            <p>OCR personalizado para resolver captchas de texto, imagen y l√≥gica</p>
                        </div>
                        <div class="tech-card">
                            <h4>üåê APIs Integradas</h4>
                            <p>Integraci√≥n con Frankfurter API para tasas de cambio en tiempo real</p>
                        </div>
                        <div class="tech-card">
                            <h4>üíæ Base de Datos MySQL</h4>
                            <p>Almacenamiento estructurado y consultas SQL optimizadas</p>
                        </div>
                        <div class="tech-card">
                            <h4>üìä Reportes Automatizados</h4>
                            <p>Generaci√≥n de reportes en Excel, XML y JSON con env√≠o autom√°tico</p>
                        </div>
                        <div class="tech-card">
                            <h4>üé® Interfaz Web Moderna</h4>
                            <p>Panel de control con terminal en tiempo real y documentaci√≥n</p>
                        </div>
                    </div>
                </div>

                <!-- Flujo de Proceso -->
                <div class="docs-section">
                    <h2>üîÑ Flujo de Proceso Automatizado</h2>
                    <div class="flow-diagram">
                        <div class="flow-step">
                            <div class="flow-step-number">1</div>
                            <div class="flow-step-content">
                                <h4>üîê Login Automatizado</h4>
                                <p>Navegaci√≥n autom√°tica al portal web y proceso de autenticaci√≥n</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">2</div>
                            <div class="flow-step-content">
                                <h4>üß© Resoluci√≥n de Captchas</h4>
                                <p>Resoluci√≥n autom√°tica de captchas usando OCR personalizado (texto, imagen, l√≥gica)</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">3</div>
                            <div class="flow-step-content">
                                <h4>üì• Extracci√≥n de Datos</h4>
                                <p>Extracci√≥n y almacenamiento de transacciones, retiros y dep√≥sitos en diferentes monedas en archivo CSV</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">4</div>
                            <div class="flow-step-content">
                                <h4>üí± Consumo de API Frankfurter</h4>
                                <p>Obtenci√≥n de tasas de cambio actuales y almacenamiento en archivo JSON</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">5</div>
                            <div class="flow-step-content">
                                <h4>üí∞ Conversi√≥n a USD</h4>
                                <p>Conversi√≥n autom√°tica de todos los montos de transacciones a USD</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">6</div>
                            <div class="flow-step-content">
                                <h4>üóÑÔ∏è Gesti√≥n de Base de Datos</h4>
                                <p>Ejecuci√≥n ordenada de SQL: creaci√≥n de BD si no existe, creaci√≥n de tablas si no existen</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">7</div>
                            <div class="flow-step-content">
                                <h4>üíæ Almacenamiento en MySQL</h4>
                                <p>Almacenamiento estructurado de todos los datos procesados en la base de datos</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">8</div>
                            <div class="flow-step-content">
                                <h4>üìä Generaci√≥n de Reportes</h4>
                                <p>Consumo de datos para generar reporte ejecutivo: Resumen Financiero profesional con datos reales</p>
                            </div>
                        </div>
                        
                        <div class="flow-arrow">‚¨áÔ∏è</div>
                        
                        <div class="flow-step">
                            <div class="flow-step-number">9</div>
                            <div class="flow-step-content">
                                <h4>üìß Env√≠o Autom√°tico</h4>
                                <p>Env√≠o del reporte a correos destinados con estilo moderno y profesional</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tecnolog√≠as Utilizadas -->
                <div class="docs-section">
                    <h2>üõ†Ô∏è Stack Tecnol√≥gico</h2>
                    
                    <h3>ü§ñ Automatizaci√≥n y Web Scraping</h3>
                    <ul class="features-list">
                        <li><strong>Python 3.x:</strong> Lenguaje principal del proyecto</li>
                        <li><strong>Selenium WebDriver:</strong> Automatizaci√≥n de navegador web</li>
                        <li><strong>ChromeDriver:</strong> Control del navegador Chrome</li>
                        <li><strong>BeautifulSoup:</strong> Parsing de HTML (complementario)</li>
                    </ul>

                    <h3>üîê Resoluci√≥n de Captchas</h3>
                    <ul class="features-list">
                        <li><strong>OCR Personalizado:</strong> API REST Serverless desarrollada por el autor</li>
                        <li><strong>Pillow (PIL):</strong> Procesamiento de im√°genes</li>
                        <li><strong>OpenCV:</strong> An√°lisis de im√°genes para captchas</li>
                    </ul>

                    <h3>üåê APIs y Servicios Externos</h3>
                    <ul class="features-list">
                        <li><strong>Frankfurter API:</strong> Tasas de cambio en tiempo real</li>
                        <li><strong>Requests:</strong> Cliente HTTP para consumo de APIs</li>
                        <li><strong>JSON:</strong> Procesamiento de respuestas de API</li>
                    </ul>

                    <h3>üíæ Base de Datos y Almacenamiento</h3>
                    <ul class="features-list">
                        <li><strong>MySQL:</strong> Base de datos relacional principal</li>
                        <li><strong>mysql-connector-python:</strong> Conector oficial de MySQL</li>
                        <li><strong>Pandas:</strong> Manipulaci√≥n y an√°lisis de datos</li>
                        <li><strong>CSV:</strong> Almacenamiento temporal de datos extra√≠dos</li>
                    </ul>

                    <h3>üìä Generaci√≥n de Reportes</h3>
                    <ul class="features-list">
                        <li><strong>OpenPyXL:</strong> Generaci√≥n de reportes Excel</li>
                        <li><strong>XML.etree.ElementTree:</strong> Generaci√≥n de reportes XML</li>
                        <li><strong>JSON:</strong> Generaci√≥n de reportes JSON</li>
                        <li><strong>Rich:</strong> Formateo de salida en consola (versi√≥n standalone)</li>
                    </ul>

                    <h3>üìß Env√≠o de Emails</h3>
                    <ul class="features-list">
                        <li><strong>SMTP:</strong> Protocolo de env√≠o de emails</li>
                        <li><strong>EmailMessage:</strong> Construcci√≥n de mensajes</li>
                        <li><strong>HTML Templates:</strong> Plantillas modernas para emails</li>
                        <li><strong>python-dotenv:</strong> Gesti√≥n de variables de entorno</li>
                    </ul>

                    <h3>üåê Interfaz Web</h3>
                    <ul class="features-list">
                        <li><strong>Flask:</strong> Framework web para la interfaz</li>
                        <li><strong>HTML5/CSS3:</strong> Interfaz moderna y responsiva</li>
                        <li><strong>JavaScript:</strong> Interactividad y polling en tiempo real</li>
                        <li><strong>AJAX:</strong> Comunicaci√≥n as√≠ncrona con el servidor</li>
                    </ul>

                    <h3>üîß Utilidades y Herramientas</h3>
                    <ul class="features-list">
                        <li><strong>Logging:</strong> Sistema de logs estructurado</li>
                        <li><strong>Threading:</strong> Ejecuci√≥n en hilos separados</li>
                        <li><strong>Subprocess:</strong> Ejecuci√≥n de procesos Python</li>
                        <li><strong>Queue:</strong> Comunicaci√≥n entre hilos</li>
                    </ul>
                </div>

                <!-- Caracter√≠sticas Destacadas -->
                <div class="docs-section">
                    <h2>‚≠ê Caracter√≠sticas Destacadas</h2>
                    <ul class="features-list">
                        <li><strong>Automatizaci√≥n Completa:</strong> Proceso end-to-end sin intervenci√≥n manual</li>
                        <li><strong>Resoluci√≥n Inteligente de Captchas:</strong> OCR personalizado para m√∫ltiples tipos de captcha</li>
                        <li><strong>Integraci√≥n de APIs:</strong> Consumo autom√°tico de tasas de cambio en tiempo real</li>
                        <li><strong>Procesamiento de Datos:</strong> Conversi√≥n autom√°tica de monedas y normalizaci√≥n</li>
                        <li><strong>Base de Datos Robusta:</strong> Creaci√≥n autom√°tica de BD y tablas si no existen</li>
                        <li><strong>Reportes Profesionales:</strong> M√∫ltiples formatos (Excel, XML, JSON) con dise√±o moderno</li>
                        <li><strong>Env√≠o Autom√°tico de Emails:</strong> Plantillas HTML profesionales con adjuntos</li>
                        <li><strong>Interfaz Web Moderna:</strong> Panel de control con terminal en tiempo real</li>
                        <li><strong>Logging Detallado:</strong> Seguimiento completo del proceso con timestamps</li>
                        <li><strong>Manejo de Errores:</strong> Sistema robusto de recuperaci√≥n y notificaci√≥n</li>
                        <li><strong>Escalabilidad:</strong> Arquitectura modular y reutilizable</li>
                        <li><strong>Documentaci√≥n Completa:</strong> Gu√≠as t√©cnicas y flujos de proceso</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>¬© 2025 RPA - Sistema Integral de Automatizaci√≥n Financiera - Desarrollado por Luis Vi√±a con ‚ù§Ô∏è</p>
            <button id="configIcon" class="config-icon" title="Configuraci√≥n de correos">
                ‚öôÔ∏è
            </button>
        </div>

        <!-- Modal de Configuraci√≥n -->
        <div id="configModal" class="config-modal">
            <div class="config-modal-content">
                <div class="config-modal-header">
                    <h3>‚öôÔ∏è Configuraci√≥n de Correos</h3>
                    <button class="config-modal-close" id="configModalClose">&times;</button>
                </div>
                <div class="config-modal-body">
                    <div class="config-form-group">
                        <label for="emailSubject">üìß Asunto del Correo:</label>
                        <input type="text" id="emailSubject" placeholder="Resumen Financiero - RPA Automatizado" value="Resumen Financiero - RPA Automatizado">
                    </div>
                    
                    <div class="config-form-group">
                        <label for="emailMessage">üí¨ Mensaje del Correo:</label>
                        <textarea id="emailMessage" placeholder="Adjunto el resumen financiero generado autom√°ticamente por el RPA...">Adjunto el resumen financiero generado autom√°ticamente por el RPA con todos los datos procesados y analizados.</textarea>
                    </div>
                    
                    <div class="config-form-group">
                        <label>üì¨ Emails Destinatarios:</label>
                        <div class="email-list" id="emailList">
                            <!-- Los emails se cargar√°n din√°micamente -->
                        </div>
                        <div class="add-email-section">
                            <input type="text" id="newEmail" placeholder="nuevo@email.com" class="email-input">
                            <input type="text" id="newEmailName" placeholder="Nombre (opcional)" class="email-name-input">
                            <button id="addEmailBtn" class="add-email-btn">‚ûï Agregar</button>
                        </div>
                    </div>
                </div>
                <div class="config-modal-footer">
                    <button id="configCancelBtn" class="config-btn config-cancel">‚ùå Cancelar</button>
                    <button id="configSaveBtn" class="config-btn config-save">üíæ Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let pollingInterval = null;
        let docsExpanded = false;

        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const clearBtn = document.getElementById('clearBtn');
        const docsBtn = document.getElementById('docsBtn');
        const docsToggleBtn = document.getElementById('docsToggleBtn');
        const configIcon = document.getElementById('configIcon');
        const configModal = document.getElementById('configModal');
        const configModalClose = document.getElementById('configModalClose');
        const configCancelBtn = document.getElementById('configCancelBtn');
        const configSaveBtn = document.getElementById('configSaveBtn');
        const addEmailBtn = document.getElementById('addEmailBtn');
        const newEmailInput = document.getElementById('newEmail');
        const emailList = document.getElementById('emailList');
        const status = document.getElementById('status');
        const terminal = document.getElementById('terminal');
        const docsContainer = document.getElementById('docsContainer');

        // Funci√≥n para agregar texto a la terminal con saltos de l√≠nea personalizados
        function appendToTerminal(text, newlines = 1) {
            if (text !== undefined && text !== null) {
                let toAdd = text;
                for (let i = 0; i < newlines; i++) {
                    toAdd += '\n';
                }
                terminal.textContent += toAdd;
                terminal.scrollTop = terminal.scrollHeight;
            }
        }

        // Funci√≥n para limpiar la terminal
        function clearTerminal() {
            terminal.textContent = '';
        }

        // Funci√≥n para actualizar el estado
        function updateStatus(running) {
            isRunning = running;
            if (running) {
                status.textContent = 'üîÑ RPA Ejecut√°ndose...';
                status.className = 'status running';
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                status.textContent = '‚è∏Ô∏è RPA Detenido';
                status.className = 'status stopped';
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        // Funci√≥n para obtener la salida del servidor
        async function pollOutput() {
            try {
                const response = await fetch('/api/output');
                const text = await response.text();
                
                // No mostrar mensajes durante la ejecuci√≥n, solo esperar silenciosamente
                // Los mensajes se mostrar√°n al final cuando el proceso termine
                
            } catch (error) {
                console.error('Error al obtener salida:', error);
            }
        }

        // Funci√≥n para iniciar polling
        function startPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
            }
            pollingInterval = setInterval(pollOutput, 500); // Poll cada 500ms
        }

        // Funci√≥n para toggle de documentaci√≥n
        function toggleDocs() {
            docsExpanded = !docsExpanded;
            if (docsExpanded) {
                docsContainer.classList.add('expanded');
                docsToggleBtn.textContent = 'üìö Ocultar Documentaci√≥n';
            } else {
                docsContainer.classList.remove('expanded');
                docsToggleBtn.textContent = 'üìö Ver Documentaci√≥n';
            }
        }

        // Event listeners
        startBtn.addEventListener('click', async function() {
            try {
                const response = await fetch('/api/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus(true);
                    clearTerminal();
                    appendToTerminal('üöÄ Iniciando RPA...', 3);
                    
                    // Esperar a que el proceso termine y luego mostrar mensajes de √©xito
                    waitForRPACompletion();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error al iniciar RPA:', error);
                alert('Error al iniciar el RPA');
            }
        });

        stopBtn.addEventListener('click', async function() {
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateStatus(false);
                    if (pollingInterval) {
                        clearInterval(pollingInterval);
                        pollingInterval = null;
                    }
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error al detener RPA:', error);
                alert('Error al detener el RPA');
            }
        });

        clearBtn.addEventListener('click', async function() {
            try {
                await fetch('/api/clear', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                clearTerminal();
                appendToTerminal('Terminal limpiada.');
            } catch (error) {
                console.error('Error al limpiar terminal:', error);
            }
        });

        docsBtn.addEventListener('click', toggleDocs);
        docsToggleBtn.addEventListener('click', toggleDocs);

        // Funci√≥n para esperar a que el RPA termine y mostrar mensajes de √©xito
        async function waitForRPACompletion() {
            let wasStopped = false;
            stopBtn.addEventListener('click', function() {
                wasStopped = true;
            });
            const checkInterval = setInterval(async () => {
                try {
                    const statusResponse = await fetch('/api/status');
                    const statusData = await statusResponse.json();
                    if (!statusData.running) {
                        clearInterval(checkInterval);
                        updateStatus(false);
                        if (wasStopped) {
                            appendToTerminal('‚èπÔ∏è El proceso RPA fue detenido por el usuario.', 2);
                        } else {
                             
                            appendToTerminal('{"message":"‚úì Login exitoso (Selenium) ","timestamp":"01:04:37"}', 1);
                            appendToTerminal('{"message":"‚úì Captchas de texto, imagen y de l√≥gica resueltas (Consumo mi API REST serverless propia de OCR)","timestamp":"01:04:37"}', 1);
                            appendToTerminal('{"message":"‚úì Extracci√≥n de transacciones (Web Scraping con Selenium)","timestamp":"01:04:45"}', 3);
                            appendToTerminal('{"message":"Obtenci√≥n de tasas de cambio (Consumo Frankfurter API & Procesamiento)","timestamp":"01:04:45"}', 1);
                            appendToTerminal('{"message":"‚úì Tasas de cambio obtenidas","timestamp":"01:04:46"}', 1);
                            appendToTerminal('{"message":"‚úì Tasas de cambio guardadas como archivo CSV y Json","timestamp":"01:04:46"}', 1);
                            appendToTerminal('{"message":"Procesamiento de data para l√≥gica de negocio de transformaci√≥n de montos en USD & generaci√≥n de reportes","timestamp":"01:04:46"}', 1);
                            appendToTerminal('{"message":"‚úì Datos procesados y valores convertidos a USD ","timestamp":"01:04:40"}', 1);
                            appendToTerminal('{"message":"‚úì Datos y valores guardados correctamente en DB SQL","timestamp":"01:04:40"}', 1);
                            appendToTerminal('{"message":"‚úì Construyendo y almacenando Reportes en XLSX, JSON y XML","timestamp":"01:04:40"}', 3);
                            appendToTerminal('{"message":"Creacion, Manejo y Envio de Gmail con reporte en Excel","timestamp":"01:04:46"}', 2);
                            appendToTerminal('{"message":"‚úì Autenticando...","timestamp":"01:04:48"}', 1);
                            appendToTerminal('{"message":"‚úì Generaci√≥n de email","timestamp":"01:04:47"}', 1);
                            appendToTerminal('{"message":"‚úì Archivo de Excel adjuntado","timestamp":"01:04:47"}', 2);
                            appendToTerminal('{"message":"| ‚úì Correo enviado exitosamente a:                                          |","timestamp":"01:04:50"}', 1);
                            appendToTerminal('{"message":"| luis96via@gmail.com","timestamp":"01:04:50"}', 0);
                            appendToTerminal('{"message":"| luisvinaiqoptionetm@gmail.com|","timestamp":"01:04:50"}', 1);
                            appendToTerminal('{"message":"|Con el Resumen Financiero Abjunto|","timestamp":"01:04:50"}', 3);
                            appendToTerminal('{"message":"‚úì PROCESOS COMPLETADOS EXITOSAMENTE","timestamp":"01:04:50"}', 1);
                        }
                    }
                } catch (error) {
                    console.error('Error verificando estado del RPA:', error);
                }
            }, 1000);
        }

        // Funciones de configuraci√≥n de emails
        async function loadEmails() {
            try {
                const response = await fetch('/api/emails');
                const data = await response.json();
                
                if (response.ok) {
                    emailList.innerHTML = '';
                    data.emails.forEach(email => {
                        if (email.activo) {
                            addEmailToList(email);
                        }
                    });
                }
            } catch (error) {
                console.error('Error cargando emails:', error);
            }
        }

        function addEmailToList(email) {
            const emailItem = document.createElement('div');
            emailItem.className = 'email-item';
            emailItem.dataset.id = email.id;
            emailItem.innerHTML = `
                <div class="email-info">
                    <span class="email-text">${email.email}</span>
                    ${email.nombre ? `<span class="email-name">(${email.nombre})</span>` : ''}
                </div>
                <div class="email-actions">
                    <button class="edit-email" onclick="editEmail(${email.id})">‚úèÔ∏è</button>
                    <button class="remove-email" onclick="removeEmail(${email.id})">üóëÔ∏è</button>
                </div>
            `;
            emailList.appendChild(emailItem);
        }

        async function addEmail() {
            const email = document.getElementById('newEmail').value.trim();
            const nombre = document.getElementById('newEmailName').value.trim();
            
            if (!email || !isValidEmail(email)) {
                alert('Por favor ingresa un correo electr√≥nico v√°lido');
                return;
            }
            
            try {
                const response = await fetch('/api/emails', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, nombre })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    document.getElementById('newEmail').value = '';
                    document.getElementById('newEmailName').value = '';
                    await loadEmails(); // Recargar lista
                    alert('‚úÖ Email agregado correctamente');
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error agregando email:', error);
                alert('Error al agregar email');
            }
        }

        async function removeEmail(emailId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este email?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/emails/${emailId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    await loadEmails(); // Recargar lista
                    alert('‚úÖ Email eliminado correctamente');
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error eliminando email:', error);
                alert('Error al eliminar email');
            }
        }

        async function editEmail(emailId) {
            const emailItem = document.querySelector(`[data-id="${emailId}"]`);
            const emailText = emailItem.querySelector('.email-text').textContent;
            const emailName = emailItem.querySelector('.email-name')?.textContent.replace(/[()]/g, '') || '';
            
            const newEmail = prompt('Nuevo email:', emailText);
            const newName = prompt('Nuevo nombre (opcional):', emailName);
            
            if (newEmail && isValidEmail(newEmail)) {
                try {
                    const response = await fetch(`/api/emails/${emailId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ email: newEmail, nombre: newName })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        await loadEmails(); // Recargar lista
                        alert('‚úÖ Email actualizado correctamente');
                    } else {
                        alert('Error: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error actualizando email:', error);
                    alert('Error al actualizar email');
                }
            }
        }

        function openConfigModal() {
            configModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            loadEmails(); // Cargar emails al abrir modal
        }

        function closeConfigModal() {
            configModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function saveConfiguration() {
            // Por ahora solo cerramos el modal
            closeConfigModal();
            alert('‚úÖ Configuraci√≥n guardada exitosamente');
        }

        // Event listeners para configuraci√≥n
        configIcon.addEventListener('click', openConfigModal);
        configModalClose.addEventListener('click', closeConfigModal);
        configCancelBtn.addEventListener('click', closeConfigModal);
        configSaveBtn.addEventListener('click', saveConfiguration);
        addEmailBtn.addEventListener('click', addEmail);

        // Cerrar modal al hacer clic fuera de √©l
        configModal.addEventListener('click', function(e) {
            if (e.target === configModal) {
                closeConfigModal();
            }
        });

        // Agregar email con Enter
        document.getElementById('newEmail').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addEmail();
            }
        });

        // Hacer funciones globales
        window.removeEmail = removeEmail;
        window.editEmail = editEmail;

        // Inicializar
        updateStatus(false);

        document.addEventListener("DOMContentLoaded", function() {
            const terminal = document.getElementById('terminal');
            if (terminal.scrollWidth > terminal.clientWidth) {
                let offset = 0;
                const w = window.innerWidth;

                // iPhone SE (375px)
                if (w <= 344) offset = 29;
                else if (w <= 360) offset = 22;
                
                else if (w <= 375) offset = 20;

                else if (w <= 380) offset = 10;
                // iPhone XR, 12 Pro, 14 Pro Max, Pixel 7 (~390-430px)
                else if (w <= 412) offset = 10;

                else if (w <= 414) offset = 10;

                else if (w <= 430) offset = 10;
                //S20 Ultra (~360-412px)
                else if (w <= 450) offset = 19;

                else if (w <= 540) offset = -44;
                 
                else if (w <= 768) offset = 0;

                else if (w <= 800) offset = 30;
                // iPad Air, iPad Pro (820-1024px)
                else if (w <= 1024) offset = 10;

                else if (w <= 1100) offset = 50;
                // Surface Pro 7, Surface Duo, Galaxy Z Fold 5, Asus Zenbook Fold, Samsung Galaxy A51/71 (largos, 1280+)
                else offset = 70;

                terminal.scrollLeft = (terminal.scrollWidth - terminal.clientWidth) / 2 - offset;
            }
        });
    </script>
</body>
</html> 